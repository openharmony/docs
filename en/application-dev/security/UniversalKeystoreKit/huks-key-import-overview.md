# Key Import Overview and Algorithm Specifications

<!--Kit: Universal Keystore Kit-->
<!--Subsystem: Security-->
<!--Owner: @wutiantian-gitee-->
<!--Designer: @HighLowWorld-->
<!--Tester: @wxy1234564846-->
<!--Adviser: @zengyawen-->

You can import an externally generated key (for example, a key generated after key agreement or generated by a server) into HUKS for management. Once a key is imported into HUKS, the plaintext can be accessed only in a secure environment in its lifecycle. This ensures that no one can obtain the plaintext of the key.

A key can be imported in plaintext or in encrypted (wrapped) mode.
> **NOTE**
> Using an existing key alias as the alias of the key imported will overwrite the existing key.

## Plaintext Import

Importing a key in plaintext may expose the plaintext to a non-secure environment. This import mode applies to <!--RP2-->mini-system devices<!--RP2End--> or security-insensitive services.

- Plaintext import is recommended to import the public key of an asymmetric key pair.

- It is not recommended to import symmetric keys or asymmetric key pairs.
  > **NOTE**
  > <!--RP2-->The mini-system devices<!--RP2End--> support plaintext import but not encrypted import.

## Encrypted Import

In this mode, the key to be imported is encrypted (wrapped) and then imported to HUKS through an end-to-end encrypted transmission channel established between the service and HUKS. This mode applies to security-sensitive services due to higher security than plaintext import. However, it involves more complex key material and operations.

- Encrypted import is recommended to import symmetric keys or asymmetric key pairs.

The following figure illustrates the development sequence of encrypted import.

![](figures/Encrypted_import_process.png)

During the encrypted import process, the following HUKS capabilities are called in sequence: 
* Generate an asymmetric key pair and export the public key for key agreement between devices.
* Generate a symmetric key to encrypt the key to be imported.
* Use the symmetric key to encrypt the key to be imported to generate the key ciphertext.
* Import a wrapped key.
* Delete a key.

The [public key plaintext material returned by the key export API is encapsulated in X.509 format](huks-concepts.md#public-key-material-format). The key material in the key import API must be encapsulated in the **Length<sub>Data</sub>-Data** format, for example, [(Length<sub>part1</sub>Data<sub>part1</sub>)... (Length<sub>partn</sub>Data<sub>partn</sub>)].

> **NOTE**<br>
> 1. The encrypted import supports key agreement algorithms ECDH and X25519. The generated **Shared_Key** uses the AES-GCM algorithm to encrypt **Caller_Kek**. For details about the cipher suites, see [HuksUnwrapSuite](../../reference/apis-universal-keystore-kit/js-apis-huks.md#huksunwrapsuite9).
> 2. The X.509 format is not supported for encrypted import.
> 3. <!--RP2-->The mini-system devices<!--RP2End--> support plaintext import but not encrypted import.

### Key Material Format for Encrypted Import

| Content| Length|
| -------- | -------- |
| Service public key **Caller_Pk** length (L<sub>Caller_Pk</sub>)| 4 bytes|
| Service public key **Caller_Pk**| L<sub>Caller_Pk</sub> bytes|
| Shared_Key **AAD2** length (L<sub>AAD2</sub>)| 4 bytes|
| Shared_Key **AAD2**| L<sub>AAD2</sub> bytes|
| Shared_Key **Nonce2** length (L<sub>Nonce2</sub>)| 4 bytes|
| Shared_Key **Nonce2**| L<sub>Nonce2</sub> bytes|
| Shared_Key **TAG2** length (L<sub>TAG2</sub>)| 4 bytes|
| Shared_Key **TAG2**| L<sub>TAG2</sub> bytes|
| **Caller_Kek_enc** length (L<sub>Caller_Kek_enc</sub>)| 4 bytes|
| Caller_Kek ciphertext **Caller_Kek_enc**| L<sub>Caller_Kek_enc</sub> bytes|
| Caller_Kek **AAD3** length (L<sub>AAD3</sub>)| 4 bytes|
| Caller_Kek **AAD3**| L<sub>AAD3</sub> bytes|
| Caller_Kek **Nonce3** length (L<sub>Nonce3</sub>)| 4 bytes|
| Caller_Kek **Nonce3**| L<sub>Nonce3</sub> bytes|
| Caller_Kek **TAG3** length (L<sub>TAG3</sub>)| 4 bytes|
| Caller_Kek **TAG3**| L<sub>TAG3</sub> bytes|
| **To_Import_Key_size** length (L<sub>To_Import_Key_size</sub>)| 4 bytes|
| Key plaintext material length **To_Import_Key_size**| L<sub>To_Import_Key_size</sub> bytes|
| **To_Import_Key_enc** length (L<sub>To_Import_Key_enc</sub>)| 4 bytes|
| To_Import_Key ciphertext **To_Import_Key_enc**| L<sub>To_Import_Key_enc</sub> bytes|

## Supported Algorithms

The following table lists the supported key import specifications.
<!--Del-->
The key management service specifications include mandatory specifications and optional specifications. Mandatory specifications are algorithm specifications that must be supported. Optional specifications can be used based on actual situation. Before using the optional specifications, refer to the documents provided by the vendor to ensure that the specifications are supported.

**You are advised to use mandatory specifications in your development for compatibility purposes.**
<!--DelEnd-->

> **NOTE**<br>
> When an RSA key is imported, the public key must be greater than or equal to 65537.

**Specifications****<!--RP1--> for standard devices<!--RP1End-->**

| Algorithm| Supported Key Length (Bit)| API Version| <!--DelCol4-->Mandatory|
| -------- | -------- | -------- | -------- |
| AES | 128, 192, 256| 8+ | Yes|
| <!--DelRow-->RSA | 512, 768, 1024| 8+ | No|
| RSA | 2048, 3072, 4096| 8+ | Yes|
| RSA | An integer multiple of 8, ranging from 1024 to 2048 (inclusive)| 18+ | Yes|
| HMAC | An integer multiple of 8, ranging from 8 to 1024 (inclusive)| 8+ | Yes|
| <!--DelRow-->ECC | 224 | 8+ | No|
| ECC | 256, 384, 521| 8+ | Yes|
| ED25519 | 256 | 8+ | Yes|
| X25519 | 256 | 8+ | Yes|
| <!--DelRow-->DSA | An integer multiple of 8, ranging from 512 to 1024 (inclusive) | 8+ | No|
| DH | 2048 | 8+ | Yes|
| <!--DelRow-->DH | 3072, 4096| 8+ | No|
| SM2 | 256 | 9+ | Yes|
| SM4 | 128 | 9+ | Yes|
| DES | 64 | 18+ | Yes|
| 3DES | 128, 192| 18+ | Yes|

**Specifications****<!--RP2--> for mini-system devices<!--RP2End-->**

<!--Del-->
Before implementing the specifications for mini-system devices, determine whether your device supports the related specifications.
<!--DelEnd-->

| Algorithm| Supported Key Length (Bit)| API Version|
| -------- | -------- | -------- |
| AES | 128, 192, 256| 12+ |
| DES | 64 | 12+ |
| 3DES | 128, 192| 12+ |
| RSA |  An integer multiple of 8, ranging from 1024 to 2048 (inclusive)| 12+ |
| HMAC | An integer multiple of 8, ranging from 8 to 1024 (inclusive)| 12+ |
| CMAC | 128 | 12+ |

## Key Import Formats
HUKS supports various types of keys in different formats. The following table lists the key types and key material formats supported by HUKS.
| Key Type| Algorithm| Import Format|
| -------- | -------- | -------- |
| Symmetric key| - | Key in bytes|
| Asymmetric key pair| - | [Key pair material format](huks-concepts.md#key-pair-material-format)|
| Public key of an asymmetric key pair| Ed25519, X25519| Key in bytes. For details, see [Importing the Public Key of an X25519 Key Pair](huks-import-key-in-plaintext-arkts.md#importing-the-public-key-of-an-x25519-key-pair).|
| Public key of an asymmetric key pair| RSA, ECC, ECDH, DSA, DH, SM2| DER format defined in X.509|
